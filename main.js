!function(){"use strict";var t=class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.data=t,this.left=e,this.right=l}};const e=new class{constructor(t){this.arr=this.sortAndFilter(t),this.root=this.buildTree(this.arr,0,this.arr.length-1)}buildTree(e,l,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(l>r)return null;const i=parseInt((l+r)/2),h=new t(e[i]);return h.left=this.buildTree(e,l,i-1,n+1),h.right=this.buildTree(e,i+1,r,n+1),h}sortAndFilter(t){const e=new Set(t);return Array.from(e).sort(((t,e)=>t-e))}insert(e){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.root;return null===l?null===this.root?(this.root=new t(e),this.root):new t(e):(e<l.data?l.left=this.insert(e,l.left):e>l.data&&(l.right=this.insert(e,l.right)),l)}delete(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.root;if(null===e)return null;if(t<e.data)e.left=this.delete(t,e.left);else if(t>e.data)e.right=this.delete(t,e.right);else{if(null===e.left&&null===e.right)return null;if(null===e.left)return e.right;if(null===e.right)return e.left;const t=this.findMin(e.right);e.data=t.data,e.right=this.delete(t.data,e.right)}return e}findMin(t){let e=t;for(;e&&null!==e.left;)e=e.left;return e}find(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.root;return null===e?null:t<e.data?this.find(t,e.left):t>e.data?this.find(t,e.right):e}levelOrderTraversal(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.root,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t=>t.data;if(!t)return[];const l=[],r=[];for(l.push(t);l.length>0;){const t=l.shift();r.push(e(t)),t.left&&l.push(t.left),t.right&&l.push(t.right)}return r}inOrderTraversal(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.root,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t=>t.data,l=[];return null!==t&&(l=l.concat(this.inOrderTraversal(t.left,e)),l.push(e(t)),l=l.concat(this.inOrderTraversal(t.right,e))),l}height(t){if(null===t)return-1;const e=this.height(t.left),l=this.height(t.right);return Math.max(e,l)+1}findDepth(t,e){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(null===t)return-1;if(t.data===e)return l;const r=this.findDepth(t.left,e,l+1);return-1!==r?r:this.findDepth(t.right,e,l+1)}isBalanced(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.root;const e=t=>{if(null===t)return{balanced:!0,height:-1};const l=e(t.left),r=e(t.right);return{balanced:l.balanced&&r.balanced&&Math.abs(l.height-r.height)<=1,height:1+Math.max(l.height,r.height)}};return e(t).balanced}rebalance(){if(!this.isBalanced()){const t=this.inOrderTraversal();this.root=this.buildTree(t,0,t.length-1)}}display(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.root;const e=function(t){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];null!==t?(null!==t.right&&e(t.right,`${l}${r?"│   ":"    "}`,!1),console.log(`${l}${r?"└── ":"┌── "}${t.data}`),null!==t.left&&e(t.left,`${l}${r?"    ":"│   "}`,!0)):console.log(`${l}${r?"└── ":"┌── "}null`)};e(t)}}(function(){const t=[];for(;t.length<100;)t.push(Math.floor(101*Math.random()));return t}());console.log("Is the tree balanced?",e.isBalanced()),console.log(e.inOrderTraversal(e.root)),e.insert(101),e.insert(141),e.insert(121),console.log("Is the tree balanced?",e.isBalanced()),e.rebalance(),console.log("Is the tree balanced?",e.isBalanced()),e.display()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUMsSUFBSSx3QkFBeUJyRCxFQUFRMEMsY0FFN0MxQyxFQUFROEMsWUFFUk0sUUFBUUMsSUFBSSx3QkFBeUJyRCxFQUFRMEMsY0FFN0MxQyxFQUFRZ0QsUyIsInNvdXJjZXMiOlsid2VicGFjazovL3RvZG8tbGlzdC8uL3NyYy9ub2RlLmpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL3NyYy9pbmRleC5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvdHJlZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBOb2RlIHtcbiAgY29uc3RydWN0b3IoZGF0YSwgbGVmdCA9IG51bGwsIHJpZ2h0ID0gbnVsbCkge1xuICAgIHRoaXMuZGF0YSA9IGRhdGE7XG4gICAgdGhpcy5sZWZ0ID0gbGVmdDtcbiAgICB0aGlzLnJpZ2h0ID0gcmlnaHQ7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTm9kZTsiLCJpbXBvcnQgVHJlZSBmcm9tICcuL3RyZWUnO1xuXG5mdW5jdGlvbiByYW5kdW1OdW1BcnIoKSB7XG4gIGNvbnN0IGFyciA9IFtdO1xuICB3aGlsZSAoYXJyLmxlbmd0aCA8IDEwMCkge1xuICAgIGFyci5wdXNoKE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMSkpO1xuICB9XG4gIHJldHVybiBhcnI7XG59XG5cbmNvbnN0IG5ld1RyZWUgPSBuZXcgVHJlZShyYW5kdW1OdW1BcnIoKSk7XG5cbmNvbnNvbGUubG9nKCdJcyB0aGUgdHJlZSBiYWxhbmNlZD8nLCBuZXdUcmVlLmlzQmFsYW5jZWQoKSk7XG5jb25zb2xlLmxvZyhuZXdUcmVlLmluT3JkZXJUcmF2ZXJzYWwobmV3VHJlZS5yb290KSk7XG5cbm5ld1RyZWUuaW5zZXJ0KDEwMSk7XG5uZXdUcmVlLmluc2VydCgxNDEpO1xubmV3VHJlZS5pbnNlcnQoMTIxKTtcblxuY29uc29sZS5sb2coJ0lzIHRoZSB0cmVlIGJhbGFuY2VkPycsIG5ld1RyZWUuaXNCYWxhbmNlZCgpKTtcblxubmV3VHJlZS5yZWJhbGFuY2UoKTtcblxuY29uc29sZS5sb2coJ0lzIHRoZSB0cmVlIGJhbGFuY2VkPycsIG5ld1RyZWUuaXNCYWxhbmNlZCgpKTtcblxubmV3VHJlZS5kaXNwbGF5KCk7XG4iLCJpbXBvcnQgTm9kZSBmcm9tICcuL25vZGUnO1xuXG5jbGFzcyBUcmVlIHtcbiAgY29uc3RydWN0b3IoYXJyKSB7XG4gICAgdGhpcy5hcnIgPSB0aGlzLnNvcnRBbmRGaWx0ZXIoYXJyKTtcbiAgICB0aGlzLnJvb3QgPSB0aGlzLmJ1aWxkVHJlZSh0aGlzLmFyciwgMCwgdGhpcy5hcnIubGVuZ3RoIC0gMSk7XG4gIH1cblxuICBidWlsZFRyZWUoYXJyLCBzdGFydCwgZW5kLCBkZXB0aCA9IDApIHtcbiAgICBpZiAoc3RhcnQgPiBlbmQpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBtaWQgPSBwYXJzZUludCgoc3RhcnQgKyBlbmQpIC8gMik7XG4gICAgY29uc3Qgbm9kZSA9IG5ldyBOb2RlKGFyclttaWRdKTtcbiAgICBub2RlLmxlZnQgPSB0aGlzLmJ1aWxkVHJlZShhcnIsIHN0YXJ0LCBtaWQgLSAxLCBkZXB0aCArIDEpO1xuICAgIG5vZGUucmlnaHQgPSB0aGlzLmJ1aWxkVHJlZShhcnIsIG1pZCArIDEsIGVuZCwgZGVwdGggKyAxKTtcbiAgICByZXR1cm4gbm9kZTtcbiAgfVxuXG4gIHNvcnRBbmRGaWx0ZXIoYXJyKSB7XG4gICAgY29uc3QgdW5pcXVlRWxlbWVudHMgPSBuZXcgU2V0KGFycik7XG4gICAgY29uc3Qgc29ydGVkQXJyYXkgPSBBcnJheS5mcm9tKHVuaXF1ZUVsZW1lbnRzKS5zb3J0KChhLCBiKSA9PiBhIC0gYik7XG4gICAgcmV0dXJuIHNvcnRlZEFycmF5O1xuICB9XG5cbiAgaW5zZXJ0KHZhbHVlLCBub2RlID0gdGhpcy5yb290KSB7XG4gICAgLy8gSWYgdGhlIHRyZWUvbm9kZSBpcyBlbXB0eSwgcmV0dXJuIGEgbmV3IG5vZGVcbiAgICBpZiAobm9kZSA9PT0gbnVsbCkge1xuICAgICAgaWYgKHRoaXMucm9vdCA9PT0gbnVsbCkge1xuICAgICAgICB0aGlzLnJvb3QgPSBuZXcgTm9kZSh2YWx1ZSk7IC8vIEVzdGFibGlzaCB0aGUgcm9vdCBpZiB0aGUgdHJlZSBpcyBlbnRpcmVseSBlbXB0eVxuICAgICAgICByZXR1cm4gdGhpcy5yb290O1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5ldyBOb2RlKHZhbHVlKTtcbiAgICB9XG5cbiAgICAvLyBPdGhlcndpc2UsIHJlY3VyIGRvd24gdGhlIHRyZWVcbiAgICBpZiAodmFsdWUgPCBub2RlLmRhdGEpIHtcbiAgICAgIG5vZGUubGVmdCA9IHRoaXMuaW5zZXJ0KHZhbHVlLCBub2RlLmxlZnQpOyAvLyBSZWN1cnNpdmUgaW5zZXJ0IG9uIHRoZSBsZWZ0IHN1YnRyZWVcbiAgICB9IGVsc2UgaWYgKHZhbHVlID4gbm9kZS5kYXRhKSB7XG4gICAgICBub2RlLnJpZ2h0ID0gdGhpcy5pbnNlcnQodmFsdWUsIG5vZGUucmlnaHQpOyAvLyBSZWN1cnNpdmUgaW5zZXJ0IG9uIHRoZSByaWdodCBzdWJ0cmVlXG4gICAgfVxuXG4gICAgLy8gUmV0dXJuIHRoZSAodW5jaGFuZ2VkKSBub2RlIHBvaW50ZXJcbiAgICByZXR1cm4gbm9kZTtcbiAgfVxuXG4gIGRlbGV0ZSh2YWx1ZSwgbm9kZSA9IHRoaXMucm9vdCkge1xuICAgIGlmIChub2RlID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gbnVsbDsgLy8gQmFzZSBjYXNlOiB2YWx1ZSBub3QgZm91bmRcbiAgICB9XG5cbiAgICBpZiAodmFsdWUgPCBub2RlLmRhdGEpIHtcbiAgICAgIG5vZGUubGVmdCA9IHRoaXMuZGVsZXRlKHZhbHVlLCBub2RlLmxlZnQpOyAvLyBHbyBsZWZ0XG4gICAgfSBlbHNlIGlmICh2YWx1ZSA+IG5vZGUuZGF0YSkge1xuICAgICAgbm9kZS5yaWdodCA9IHRoaXMuZGVsZXRlKHZhbHVlLCBub2RlLnJpZ2h0KTsgLy8gR28gcmlnaHRcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gTm9kZSB0byBkZWxldGUgaXMgZm91bmRcbiAgICAgIGlmIChub2RlLmxlZnQgPT09IG51bGwgJiYgbm9kZS5yaWdodCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDsgLy8gTm8gY2hpbGRyZW4sIHJldHVybiBudWxsIHRvIHVubGluayBub2RlXG4gICAgICB9XG4gICAgICBpZiAobm9kZS5sZWZ0ID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBub2RlLnJpZ2h0OyAvLyBPbmUgY2hpbGQgKHJpZ2h0KSwgcmV0dXJuIGl0IHRvIGxpbmsgaXQgYmFjayB0byBwYXJlbnRcbiAgICAgIH1cbiAgICAgIGlmIChub2RlLnJpZ2h0ID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBub2RlLmxlZnQ7IC8vIE9uZSBjaGlsZCAobGVmdCksIHJldHVybiBpdCB0byBsaW5rIGl0IGJhY2sgdG8gcGFyZW50XG4gICAgICB9XG5cbiAgICAgIC8vIFR3byBjaGlsZHJlbiwgZ2V0IHRoZSBpbm9yZGVyIHN1Y2Nlc3NvciAoc21hbGxlc3QgaW4gdGhlIHJpZ2h0IHN1YnRyZWUpXG4gICAgICBjb25zdCBzdWNjZXNzb3IgPSB0aGlzLmZpbmRNaW4obm9kZS5yaWdodCk7XG4gICAgICBub2RlLmRhdGEgPSBzdWNjZXNzb3IuZGF0YTsgLy8gQ29weSB0aGUgaW5vcmRlciBzdWNjZXNzb3IncyB2YWx1ZSB0byB0aGUgbm9kZVxuICAgICAgbm9kZS5yaWdodCA9IHRoaXMuZGVsZXRlKHN1Y2Nlc3Nvci5kYXRhLCBub2RlLnJpZ2h0KTsgLy8gRGVsZXRlIHRoZSBpbm9yZGVyIHN1Y2Nlc3NvclxuICAgIH1cbiAgICByZXR1cm4gbm9kZTtcbiAgfVxuXG4gIGZpbmRNaW4obm9kZSkge1xuICAgIGxldCBjdXJyZW50ID0gbm9kZTtcbiAgICB3aGlsZSAoY3VycmVudCAmJiBjdXJyZW50LmxlZnQgIT09IG51bGwpIHtcbiAgICAgIGN1cnJlbnQgPSBjdXJyZW50LmxlZnQ7XG4gICAgfVxuICAgIHJldHVybiBjdXJyZW50O1xuICB9XG5cbiAgZmluZCh2YWx1ZSwgbm9kZSA9IHRoaXMucm9vdCkge1xuICAgIC8vIEJhc2UgY2FzZTogY2hlY2sgaWYgdGhlIGN1cnJlbnQgbm9kZSBpcyBudWxsXG4gICAgaWYgKG5vZGUgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8vIE5hdmlnYXRlIGxlZnRcbiAgICBpZiAodmFsdWUgPCBub2RlLmRhdGEpIHtcbiAgICAgIHJldHVybiB0aGlzLmZpbmQodmFsdWUsIG5vZGUubGVmdCk7XG4gICAgfVxuICAgIC8vIE5hdmlnYXRlIHJpZ2h0XG4gICAgaWYgKHZhbHVlID4gbm9kZS5kYXRhKSB7XG4gICAgICByZXR1cm4gdGhpcy5maW5kKHZhbHVlLCBub2RlLnJpZ2h0KTtcbiAgICB9XG4gICAgLy8gSWYgdGhlIGN1cnJlbnQgbm9kZSdzIGRhdGEgbWF0Y2hlcyB0aGUgc2VhcmNoIHZhbHVlLCByZXR1cm4gdGhlIG5vZGVcbiAgICByZXR1cm4gbm9kZTtcbiAgfVxuXG4gIGxldmVsT3JkZXJUcmF2ZXJzYWwocm9vdCA9IHRoaXMucm9vdCwgY2FsbGJhY2sgPSAobm9kZSkgPT4gbm9kZS5kYXRhKSB7XG4gICAgaWYgKCFyb290KSByZXR1cm4gW107IC8vIEhhbmRsZSBhbiBlbXB0eSB0cmVlXG5cbiAgICBjb25zdCBxdWV1ZSA9IFtdO1xuICAgIGNvbnN0IHJlc3VsdCA9IFtdOyAvLyBBcnJheSB0byBob2xkIHJlc3VsdHMgb2YgY2FsbGJhY2tcbiAgICBxdWV1ZS5wdXNoKHJvb3QpO1xuXG4gICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGN1cnJlbnROb2RlID0gcXVldWUuc2hpZnQoKTtcbiAgICAgIHJlc3VsdC5wdXNoKGNhbGxiYWNrKGN1cnJlbnROb2RlKSk7IC8vIEFwcGx5IGNhbGxiYWNrIHRvIGVhY2ggbm9kZVxuXG4gICAgICBpZiAoY3VycmVudE5vZGUubGVmdCkge1xuICAgICAgICBxdWV1ZS5wdXNoKGN1cnJlbnROb2RlLmxlZnQpO1xuICAgICAgfVxuICAgICAgaWYgKGN1cnJlbnROb2RlLnJpZ2h0KSB7XG4gICAgICAgIHF1ZXVlLnB1c2goY3VycmVudE5vZGUucmlnaHQpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLy8gTWV0aG9kIHRvIHBlcmZvcm0gaW5vcmRlciB0cmF2ZXJzYWxcbiAgaW5PcmRlclRyYXZlcnNhbChub2RlID0gdGhpcy5yb290LCBjYWxsYmFjayA9IChub2RlKSA9PiBub2RlLmRhdGEpIHtcbiAgICBsZXQgcmVzdWx0ID0gW107XG4gICAgaWYgKG5vZGUgIT09IG51bGwpIHtcbiAgICAgIHJlc3VsdCA9IHJlc3VsdC5jb25jYXQodGhpcy5pbk9yZGVyVHJhdmVyc2FsKG5vZGUubGVmdCwgY2FsbGJhY2spKTsgLy8gQWNjdW11bGF0ZSBsZWZ0IHN1YnRyZWVcbiAgICAgIHJlc3VsdC5wdXNoKGNhbGxiYWNrKG5vZGUpKTsgLy8gUHJvY2VzcyBhbmQgYWRkIGN1cnJlbnQgbm9kZVxuICAgICAgcmVzdWx0ID0gcmVzdWx0LmNvbmNhdCh0aGlzLmluT3JkZXJUcmF2ZXJzYWwobm9kZS5yaWdodCwgY2FsbGJhY2spKTsgLy8gQWNjdW11bGF0ZSByaWdodCBzdWJ0cmVlXG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBoZWlnaHQobm9kZSkge1xuICAgIGlmIChub2RlID09PSBudWxsKSByZXR1cm4gLTE7XG5cbiAgICAvLyBDb21wdXRlIHRoZSBoZWlnaHQgb2YgZWFjaCBzdWJ0cmVlXG4gICAgY29uc3QgbGhlaWdodCA9IHRoaXMuaGVpZ2h0KG5vZGUubGVmdCk7XG4gICAgY29uc3QgcmhlaWdodCA9IHRoaXMuaGVpZ2h0KG5vZGUucmlnaHQpO1xuXG4gICAgLy8gVXNlIHRoZSBsYXJnZXIgb25lIGFuZCBhZGQgMSBmb3IgdGhlIGN1cnJlbnQgbm9kZVxuICAgIHJldHVybiBNYXRoLm1heChsaGVpZ2h0LCByaGVpZ2h0KSArIDE7XG4gIH1cblxuICBmaW5kRGVwdGgobm9kZSwgdGFyZ2V0LCBkZXB0aCA9IDApIHtcbiAgICBpZiAobm9kZSA9PT0gbnVsbCkgcmV0dXJuIC0xOyAvLyBCYXNlIGNhc2U6IG5vZGUgbm90IGZvdW5kXG4gICAgaWYgKG5vZGUuZGF0YSA9PT0gdGFyZ2V0KSByZXR1cm4gZGVwdGg7IC8vIFRhcmdldCBub2RlIGZvdW5kLCByZXR1cm4gY3VycmVudCBkZXB0aFxuXG4gICAgLy8gUmVjdXJzaXZlbHkgc2VhcmNoIGZvciB0YXJnZXQgaW4gbGVmdCBhbmQgcmlnaHQgc3VidHJlZXNcbiAgICBjb25zdCBsZWZ0ID0gdGhpcy5maW5kRGVwdGgobm9kZS5sZWZ0LCB0YXJnZXQsIGRlcHRoICsgMSk7XG4gICAgaWYgKGxlZnQgIT09IC0xKSByZXR1cm4gbGVmdDsgLy8gVGFyZ2V0IGZvdW5kIGluIGxlZnQgc3VidHJlZVxuXG4gICAgcmV0dXJuIHRoaXMuZmluZERlcHRoKG5vZGUucmlnaHQsIHRhcmdldCwgZGVwdGggKyAxKTsgLy8gQ2hlY2sgcmlnaHQgc3VidHJlZVxuICB9XG5cbiAgaXNCYWxhbmNlZChub2RlID0gdGhpcy5yb290KSB7XG4gICAgY29uc3QgY2hlY2tCYWxhbmNlID0gKG5vZGUpID0+IHtcbiAgICAgIGlmIChub2RlID09PSBudWxsKSByZXR1cm4geyBiYWxhbmNlZDogdHJ1ZSwgaGVpZ2h0OiAtMSB9O1xuXG4gICAgICBjb25zdCBsZWZ0ID0gY2hlY2tCYWxhbmNlKG5vZGUubGVmdCk7XG4gICAgICBjb25zdCByaWdodCA9IGNoZWNrQmFsYW5jZShub2RlLnJpZ2h0KTtcblxuICAgICAgY29uc3QgYmFsYW5jZWQgPSBsZWZ0LmJhbGFuY2VkICYmIHJpZ2h0LmJhbGFuY2VkICYmIE1hdGguYWJzKGxlZnQuaGVpZ2h0IC0gcmlnaHQuaGVpZ2h0KSA8PSAxO1xuICAgICAgY29uc3QgaGVpZ2h0ID0gMSArIE1hdGgubWF4KGxlZnQuaGVpZ2h0LCByaWdodC5oZWlnaHQpO1xuXG4gICAgICByZXR1cm4geyBiYWxhbmNlZCwgaGVpZ2h0IH07XG4gICAgfTtcblxuICAgIHJldHVybiBjaGVja0JhbGFuY2Uobm9kZSkuYmFsYW5jZWQ7XG4gIH1cblxuICByZWJhbGFuY2UoKSB7XG4gICAgaWYgKCF0aGlzLmlzQmFsYW5jZWQoKSkge1xuICAgICAgY29uc3QgbmV3QXJyID0gdGhpcy5pbk9yZGVyVHJhdmVyc2FsKCk7IC8vIEdldCBhbGwgbm9kZSB2YWx1ZXMgaW4gb3JkZXJcbiAgICAgIHRoaXMucm9vdCA9IHRoaXMuYnVpbGRUcmVlKG5ld0FyciwgMCwgbmV3QXJyLmxlbmd0aCAtIDEpOyAvLyBSZWJ1aWxkIHRyZWUgZnJvbSBzb3J0ZWQgYXJyYXlcbiAgICB9XG4gIH1cblxuICBkaXNwbGF5KG5vZGUgPSB0aGlzLnJvb3QpIHtcbiAgICBjb25zdCBwcmV0dHlQcmludCA9IChub2RlLCBwcmVmaXggPSAnJywgaXNMZWZ0ID0gdHJ1ZSkgPT4ge1xuICAgICAgaWYgKG5vZGUgPT09IG51bGwpIHtcbiAgICAgICAgY29uc29sZS5sb2coYCR7cHJlZml4fSR7aXNMZWZ0ID8gJ+KUlOKUgOKUgCAnIDogJ+KUjOKUgOKUgCAnfW51bGxgKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKG5vZGUucmlnaHQgIT09IG51bGwpIHtcbiAgICAgICAgcHJldHR5UHJpbnQobm9kZS5yaWdodCwgYCR7cHJlZml4fSR7aXNMZWZ0ID8gJ+KUgiAgICcgOiAnICAgICd9YCwgZmFsc2UpO1xuICAgICAgfVxuICAgICAgY29uc29sZS5sb2coYCR7cHJlZml4fSR7aXNMZWZ0ID8gJ+KUlOKUgOKUgCAnIDogJ+KUjOKUgOKUgCAnfSR7bm9kZS5kYXRhfWApO1xuICAgICAgaWYgKG5vZGUubGVmdCAhPT0gbnVsbCkge1xuICAgICAgICBwcmV0dHlQcmludChub2RlLmxlZnQsIGAke3ByZWZpeH0ke2lzTGVmdCA/ICcgICAgJyA6ICfilIIgICAnfWAsIHRydWUpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBwcmV0dHlQcmludChub2RlKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBUcmVlO1xuIl0sIm5hbWVzIjpbImNvbnN0cnVjdG9yIiwiZGF0YSIsImxlZnQiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJyaWdodCIsInRoaXMiLCJuZXdUcmVlIiwiYXJyIiwic29ydEFuZEZpbHRlciIsInJvb3QiLCJidWlsZFRyZWUiLCJzdGFydCIsImVuZCIsImRlcHRoIiwibWlkIiwicGFyc2VJbnQiLCJub2RlIiwiTm9kZSIsInVuaXF1ZUVsZW1lbnRzIiwiU2V0IiwiQXJyYXkiLCJmcm9tIiwic29ydCIsImEiLCJiIiwiaW5zZXJ0IiwidmFsdWUiLCJkZWxldGUiLCJzdWNjZXNzb3IiLCJmaW5kTWluIiwiY3VycmVudCIsImZpbmQiLCJsZXZlbE9yZGVyVHJhdmVyc2FsIiwiY2FsbGJhY2siLCJxdWV1ZSIsInJlc3VsdCIsInB1c2giLCJjdXJyZW50Tm9kZSIsInNoaWZ0IiwiaW5PcmRlclRyYXZlcnNhbCIsImNvbmNhdCIsImhlaWdodCIsImxoZWlnaHQiLCJyaGVpZ2h0IiwiTWF0aCIsIm1heCIsImZpbmREZXB0aCIsInRhcmdldCIsImlzQmFsYW5jZWQiLCJjaGVja0JhbGFuY2UiLCJiYWxhbmNlZCIsImFicyIsInJlYmFsYW5jZSIsIm5ld0FyciIsImRpc3BsYXkiLCJwcmV0dHlQcmludCIsInByZWZpeCIsImlzTGVmdCIsImNvbnNvbGUiLCJsb2ciLCJmbG9vciIsInJhbmRvbSIsInJhbmR1bU51bUFyciJdLCJzb3VyY2VSb290IjoiIn0=